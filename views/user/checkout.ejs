
<%- include('_userheader') %>

<body>

    <!-- Start Header Area -->
	<%- include('_headerNavBar') %>
	<!-- End Header Area -->

    <!-- Start Banner Area -->
    <section class="banner-area organic-breadcrumb">
        <div class="container">
            <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
                <div class="col-first">
                    <h1>Checkout</h1>
                    <nav class="d-flex align-items-center">
                        <a href="/loadingPage">Home<span class="lnr lnr-arrow-right"></span></a>
                        <a href="/checkout">Checkout</a>
                    </nav>
                </div>
            </div>
        </div>
    </section>
    <!-- End Banner Area -->

    <!--================Checkout Area =================-->
    <section class="checkout_area section_gap">
        <div class="container">
            
            
            <div class="billing_details">
                <div class="row">
                    <div class="col-lg-6 mt-2 ">
                        <% if (address) { %>
                            <div class="col-md-12">
                               <h3 class="mt-4" style="color: brown;">Billing Details</h3>
                             <!-- <input value="address" class="pixel-radio" type="radio" id="apple" name="address"><label for="address"> -->
                                <h5><%= address.firstName %></h5>
                                <h5><%= address.addressLine1 %></h5>
                                <h5><%= address.addressLine2 %></h5>
                                <h5><%= address.district %>,<%= address.state %>,<%= address.country %></h5>
                                <h5></h5>
                                <h5></h5>
                                <h5>Pincode:<%= address.postcode %></h5>
                                <h5><%= address.email %></h5>
                                <h5>Ph:<%= address.phone %></h5></label>
                                <hr class="divider">
                              
                           </div>
                           <div class="col-md-12" >
                               <h3 style="color: brown;">Coupon for You</h3>
                            <% if (coupon) { %>
                               <% for( let i = 0; i < coupon.length; i++ ) { %>
                                <h3><%= i+1 %>.<%= coupon[i].name %> coupon code: <a href="#"><%= coupon[i].codeName %></a> </h3>
                               <% } %>  
                            <% } %>
                            <form  class="" action="/checkout/<%= address._id %>" method="post">
                            <div class="col-md-6 form-group">
								<input type="text" class="form-control" id="coupon" name="coupon" placeholder="Enter Coupon Code" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter Coupon Code'">
							</div>
                            <div class="col-md-12 form-group ">
                                <% if (cart) { %>
                                    <% let sum=0 %>
                                    <% (cart.products).forEach(element => { %>
                                        <% sum = sum+(element.price*element.quantity); %>
                                        <% }) %>
                                        <a  onclick="addCoupon(document.getElementById('coupon'),'<%=sum %>','<%= wallet.amount %>','<%=user.couponUsed%>')"  class="primary-btn">Apply</a>
                                        <a  onclick="walletPayment('<%=sum %>','<%= wallet.amount %>')"  class="primary-btn">Remove</a>
                                        <% } %>
							</div>

                            <% } %>
                           </div>
                    </div>
                    <div class="col-lg-6 ">
                        <div class="order_box">
                            <h2>Your Order</h2>
                            
                            <ul class="list">
                                <li><a href="#">Product <span>Total</span></a></li>
                                <% if (cart) { %>
                                    <% let sum=0 %>
                                    <% (cart.products).forEach(element => { %>
                                     
                                    
                                     <li><a href="#"><%= element.name %><span class="middle">x <%= element.quantity %></span> <span class="last"><%= element.price*element.quantity %></span></a></li>
                                    
                                     <% sum = sum+(element.price*element.quantity); %>
                                     <% }) %>
                                     
                            </ul>
                            <div class="container ">
                                <div class="row ">
                            <ul class="list list_2">
                                <li><a href="#">Subtotal <span><%= sum %></span></a></li>
                                <li><a href="#">Shipping <span>00.00</span></a></li>
                              
                                     
                                        <% if (wallet) { %>
                                            
                                        <div class="payment_item col-md-12">
                                           
                                                <div class="radion_btn">
                                                        <div  class="container">
                                                            <div class="row">
                                                                <input onclick="walletPayment('<%=sum %>','<%= wallet.amount %>')"  type="checkbox" id="f-option9" name="secondaryPayment" value="wallet">
                                                                 <input hidden name="sum" value="<%= sum %>" >
                                                                <label class="col-md-10" for="f-option9"> Wallet  </label>
                                                                <h6 id="walletAmout" ><%= wallet.amount %></h6>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <p>You can use amount from the wallet </p>
                                                <div class="radion_btn">
                                                    <input type="checkbox"  onclick="subtotal('<%=sum %>')" id="f-option5" name="primaryPayment" value="cod">
                                                    <label for="f-option5">Cash On Delivery</label>
                                                    
                                                </div>
                                                <p>Please send a check to Store Name, Store Street, Store Town, Store State / County,
                                                    Store Postcode.</p>
                                                </div>
                                                <div class="payment_item col-md-12 ">
                                                    <div class="radion_btn">
                                                        <input type="checkbox"  onclick="walletPayment('<%=sum %>','<%= wallet.amount %>')" id="f-option6" name="primaryPayment" value="paypal">
                                                        <label for="f-option6">Paypal </label>
                                                        <img src="/assets/img/product/card.jpg" alt="">
                                                       
                                                    </div>
                                                    <p>Pay via PayPal; you can pay with your credit card if you don’t have a PayPal
                                                        account.</p>
                                                    </div>
                                                    <!-- <div class="creat_account">
                                                        <input type="checkbox" id="f-option4" name="selector" required="true">
                                                        <label for="f-option4">I’ve read and accept the </label>
                                                        <a href="#">terms & conditions*</a>
                                                    </div> -->
                                                    <li><a href="#">Total <span id="subtotal" value=""></span><span><i class="fa fa-inr" aria-hidden="true"></i></span></a></li>
                                                </ul>
                                                    <div class="button col-md-12">
                                                        <button type="submit" class="primary-btn">Proceed to Payment</button>
                                                        
                                                    </div>
                                                </div>
                                     </div>
                                        </form>
                                        <% } %>
                               <% } %> 
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
   
    <!--================End Checkout Area =================-->


    <!-- start footer Area -->
    <footer class="footer-area section_gap">
        <div class="container">
            <div class="row">
                <div class="col-lg-3  col-md-6 col-sm-6">
                    <div class="single-footer-widget">
                        <h6>About Us</h6>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt
                            ut labore dolore
                            magna aliqua.
                        </p>
                    </div>
                </div>
                <div class="col-lg-4  col-md-6 col-sm-6">
                    <div class="single-footer-widget">
                        <h6>Newsletter</h6>
                        <p>Stay update with our latest</p>
                        <div class="" id="mc_embed_signup">

                            <form target="_blank" novalidate="true" action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                                method="get" class="form-inline">

                                <div class="d-flex flex-row">

                                    <input class="form-control" name="EMAIL" placeholder="Enter Email" onfocus="this.placeholder = ''"
                                        onblur="this.placeholder = 'Enter Email '" required="" type="email">


                                    <button class="click-btn btn btn-default"><i class="fa fa-long-arrow-right"
                                            aria-hidden="true"></i></button>
                                    <div style="position: absolute; left: -5000px;">
                                        <input name="b_36c4fd991d266f23781ded980_aefe40901a" tabindex="-1" value=""
                                            type="text">
                                    </div>

                                    <!-- <div class="col-lg-4 col-md-4">
													<button class="bb-btn btn"><span class="lnr lnr-arrow-right"></span></button>
												</div>  -->
                                </div>
                                <div class="info"></div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3  col-md-6 col-sm-6">
                    <div class="single-footer-widget mail-chimp">
                        <h6 class="mb-20">Instragram Feed</h6>
                        <ul class="instafeed d-flex flex-wrap">
                            <li><img src="/assets/img/i1.jpg" alt=""></li>
                            <li><img src="/assets/img/i2.jpg" alt=""></li>
                            <li><img src="/assets/img/i3.jpg" alt=""></li>
                            <li><img src="/assets/img/i4.jpg" alt=""></li>
                            <li><img src="/assets/img/i5.jpg" alt=""></li>
                            <li><img src="/assets/img/i6.jpg" alt=""></li>
                            <li><img src="/assets/img/i7.jpg" alt=""></li>
                            <li><img src="/assets/img/i8.jpg" alt=""></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6">
                    <div class="single-footer-widget">
                        <h6>Follow Us</h6>
                        <p>Let us be social</p>
                        <div class="footer-social d-flex align-items-center">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-dribbble"></i></a>
                            <a href="#"><i class="fa fa-behance"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-bottom d-flex justify-content-center align-items-center flex-wrap">
                <p class="footer-text m-0"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
</p>
            </div>
        </div>
    </footer>
    <!-- End footer Area -->


    <script>
        function subtotal(sum){
            document.getElementById('subtotal').innerHTML=sum
        }

       function walletPayment(sum,wallet){
           
           console.log(wallet,sum);
           if(parseInt(wallet) >= parseInt(sum) ){
            let walletAmout=wallet-sum
            let output= 0
           document.getElementById('subtotal').innerHTML=output
           document.getElementById('walletAmout').innerHTML=walletAmout
        }else{
           let output= sum-wallet
           document.getElementById('subtotal').innerHTML=output
        }
       
           }

           function addCoupon(coupon, sum, wallet, couponUsed) {
          fetch('/coupon',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({coupon:coupon.value})})
         
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            console.log(data);
            if(coupon.value != "first10" && coupon.value != "next20"){
                console.log("his is",coupon.value);
                alert("use valid coupon")
             }
            if(coupon.value === "first10"){
                alert("using first 10% coupon")
              let output=sum-(10*sum)/100
              document.getElementById('subtotal').innerHTML=output
             }
             if(coupon.value === "next20"){
               alert("using next 20% coupon")
              let output=sum-(20*sum)/100
              document.getElementById('subtotal').innerHTML=output
             }
               
          }else{
            alert("coupon already used once")
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    }


        function removeCoupon(){
            if(coupon.value){
           
           if(coupon.value === "first10"){
              
              let output=sum-(10*sum)/100
              document.getElementById('subtotal').innerHTML=output
             }
             if(coupon.value === "next20"){
               
              let output=sum-(20*sum)/100
              document.getElementById('subtotal').innerHTML=output
             }  
       
    }
        }

          
    </script>

    <script>
      
    </script>







   <%- include('_userfooter') %>